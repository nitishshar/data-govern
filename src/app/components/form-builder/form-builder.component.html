<mat-stepper [linear]="isLinear" #stepper>
  <mat-step [stepControl]="basicDetailsForm">
    <ng-template matStepLabel>Basic Details</ng-template>
    <form [formGroup]="basicDetailsForm">
      <div class="form-field">
        <label>Title</label>
        <div class="field-container">
          <mat-form-field appearance="outline">
            <input matInput formControlName="title" placeholder="Enter title">
            <mat-error *ngIf="basicDetailsForm.get('title')?.errors?.['required']">
              Required
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <div class="form-field">
        <label>Description</label>
        <div class="field-container">
          <mat-form-field appearance="outline">
            <textarea matInput formControlName="description" 
                      rows="3" 
                      placeholder="Enter description"></textarea>
            <mat-error *ngIf="basicDetailsForm.get('description')?.errors?.['required']">
              Required
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Change Details</mat-panel-title>
        </mat-expansion-panel-header>

        <div formGroupName="changeDetails">
          <div class="form-field">
            <label>Target Date</label>
            <div class="field-container">
              <mat-form-field appearance="outline">
                <input matInput [matDatepicker]="deploymentPicker" 
                       formControlName="targetDeploymentDate">
                <mat-datepicker-toggle matSuffix [for]="deploymentPicker"></mat-datepicker-toggle>
                <mat-datepicker #deploymentPicker></mat-datepicker>
              </mat-form-field>
            </div>
          </div>

          <div class="form-field">
            <label>Review Date</label>
            <div class="field-container">
              <mat-form-field appearance="outline">
                <input matInput [matDatepicker]="reviewPicker" 
                       formControlName="reviewalDate">
                <mat-datepicker-toggle matSuffix [for]="reviewPicker"></mat-datepicker-toggle>
                <mat-datepicker #reviewPicker></mat-datepicker>
              </mat-form-field>
            </div>
          </div>

          <div class="form-field">
            <label>Status</label>
            <div class="field-container">
              <mat-form-field appearance="outline">
                <mat-select formControlName="status" placeholder="Select status">
                  <mat-option *ngFor="let status of statuses" [value]="status">
                    {{status}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="form-field">
            <label>Change Type</label>
            <div class="field-container">
              <mat-form-field appearance="outline">
                <mat-select formControlName="changeType" placeholder="Select change type">
                  <mat-option *ngFor="let type of changeTypes" [value]="type">
                    {{type}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="form-field">
            <label>Description</label>
            <div class="field-container">
              <mat-form-field appearance="outline">
                <textarea matInput formControlName="changeDescription" 
                          rows="3" 
                          placeholder="Describe the changes"></textarea>
              </mat-form-field>
            </div>
          </div>

          <div class="form-field">
            <label>Jira Key</label>
            <div class="field-container">
              <mat-form-field appearance="outline">
                <input matInput formControlName="jiraKey" 
                       placeholder="Enter Jira ticket number">
              </mat-form-field>
            </div>
          </div>
        </div>
      </mat-expansion-panel>

      <div class="button-row">
        <button mat-button matStepperNext [disabled]="!basicDetailsForm.valid">Next</button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="feedDetailsForm">
    <ng-template matStepLabel>Feed Details</ng-template>
    <form [formGroup]="feedDetailsForm">
      
      <mat-expansion-panel *ngFor="let section of feedDetailsConfig" class="section-panel">
        <mat-expansion-panel-header>
          <mat-panel-title>{{section.title}}</mat-panel-title>
        </mat-expansion-panel-header>
        
        <div [formGroupName]="getSectionGroupName(section.category)">
          <div class="form-field" *ngFor="let field of section.fields">
            <app-dynamic-field 
              [field]="field" 
              [form]="getFormGroup(section.category)">
            </app-dynamic-field>
          </div>
        </div>
      </mat-expansion-panel>

      <div class="button-row">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext [disabled]="!feedDetailsForm.valid">Next</button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="feedAttributesForm">
    <ng-template matStepLabel>Feed Attributes</ng-template>
    <form [formGroup]="feedAttributesForm">
      <!-- Feed Attributes content -->
      <div class="button-row">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-raised-button 
                color="primary" 
                (click)="onSave()" 
                [disabled]="!isFormValid() || isSaving">
          {{ isSaving ? 'Saving...' : 'Save' }}
        </button>
      </div>
    </form>
  </mat-step>
</mat-stepper> 